# 명세서 기반 학습 - 경로 계획 및 판단/제어

---

## 필수 지식 학습

---

### 좌표계

---

- 직교 좌표계
    - 일반적인 xyz 좌표계
    - IMU 센서가 이 좌표계 사용

- 원통 좌표계
    - 극좌표계 (2차원)
        - 반지름 : 물체와의 거리
        - 각도 : 기준각도와 이루는 각
    - 극 좌표계와 높이를 합쳐 만든게 원통좌표계
    - LiDAR가 이 좌표계 사용
    
- 구면 좌표계
    - 반지름, x축과 이루는 각도, z축과 이루는 각도
    
- 센서에서 바라보는 좌표계에 따라 다르게 표현됨
    - 월드 좌표계, 로컬 좌표계 등

### GPS 좌표계

---

- WGS84 (World Geodetic System)
    - 위도, 경도 좌표
    - 2D 좌표계 기준 경로 계획 문제 해결 불가
        
        → 평면 좌표계로 변환 필요 → UTM 좌표계로 변환
        
    
- UTM 좌표계 (Universal Transverse Mercator)
    - 임의의 한 점을 기준으로 수직, 수평 선을 긋고 그 축과 평행한 수직 / 수평 축을 그어서 정의
    - 수직으로 A ~ Z
    - 수평으로 0 ~ 99
    - 위 기준에 따라 구역을 나눔 (한국은 Zone 52S)
    

### 물체의 자세

---

- 오일러각과 쿼터니언으로 표현
- 오일러각
    - 물체의 자세를 3축 회전으로 표현 (Roll Pitch Yaw)
    - 몇몇 자세를 표현하지 못하는 짐벌락 현상 발생
        
        <aside>
        💡 **짐벌락 현상**
        
        - 두 회전축이 겹치게되면 나머지 한 축은 돌려봤자 상태가 변하지 않는 현상
        </aside>
        
    - 이 오일러 각은 각 축을 각각 계산하기 때문에, 앞서 회전한 축에 의해 짐벌락 현상이 발생하면 다음 축의 연산이 불가함
    - 따라서, 쿼터니언으로 변환하여 연산이 필요함

- 쿼터니언
    - 물체의 3차원 회전 각도를 표현하는 방식 중 하나로 회전 축을 표현하는 x,y,z축 회전축 벡터와 회전 각 스칼라만 사용
    - 물체의 회전 각을 한번에 계산하여 짐벌락 현상을 방지할 수 있음
    - ROS의 TF 패키지를 사용하여 오일러 각 → 쿼터니언 변환이 가능함

### 정밀도로 지도

---

- 자율주행에 필요한 정보를 3차원으로 제작한 지도
- 구성
    - 차선
        - 규제선, 도로경계선, 정지선, 차로중심선
    - 도로시설
        - 중앙분리대, 터널, 교량, 지하차도
    - 표지시설
        - 교통안전표지, 노면 표시, 신호기

- 해상도
    - 0.25m
    - 국토지리정보원에서 제작 및 배포

### MGeo

---

- MORAI + Geometry
- 시뮬레이터에서 사용되는 정밀지도 포맷
- MGeo 포맷에서 Node, Link를 불러와 필요한 경로를 생성할 수 있음

### 경로계획

---

- 차량이 주행할 경로 만들어주는 과정
- 안전한 경로, 최적화된 경로에 대한 고려 필요
- 전역 계획, 지역 계획으로 나뉨

- 전역 계획
    - 출발지 → 목적지 지정 시 생기는 경로
- 지역 계획
    - 주행 도중 변경되어 생성된 경로
    - 전역 경로와 센서 데이터를 통해 생성

### Dijkstra

---

- Node간 최단 경로 탐색 알고리즘
- MGeo에서 Node, Link 정보를 통해 알고리즘 적용 → 주행 경로 생성

### Pure pursuit

---

- 경로 위의 한 점을 원 호를 그리며 따라가는 방법
- 전방주시거리 하나의 파라미터로 조향각을 간단하게 계산할 수 있는 간단한 알고리즘
- Bicycle 모델 사용 → 뒷 바퀴 1개와 조향이 가능한 앞 바퀴 1개

- 차량의 속도에 따라 적절한 전방주시거리를 책정
    - 전방주시거리에 따라 다음 목표지점이 결정됨
    - 빠를수록 멀리 봐야함
    - 거리를 짧게 측정할 경우
        - 설정된 경로로 빠르게 복귀
        - 경로를 초과하여 진동할 수 있음
    - 거리를 길게 측정한 경우
        - 목표 경로를 따라 부드럽게 주행할 수 있음
        - 코너에서 경유지를 정확히 따라가지 않을 수 있음
    
1. 전방주시거리가 확정
2. 다음 목표 지점 확정
3. 전방주시거리 + 다음 목표 지점과 뒷바퀴의 각도 ⇒ 조향각 유도

## 기능 명세

---

- 위치 인식
- 정밀도로 지도
- 경로계획
- 판단/제어