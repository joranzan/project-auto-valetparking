# Today I learned


##### 2024-02-27
##### ROS 통신 프로토콜 명세서
##### 조한준

---


## 자율주행 필수지식 

<aside>
💡 최소한의 학습 범위
</aside>


<br>



## 1) ROS (Robot Operating System)

<br>

<aside>
💡 로봇 소프트웨어를 개발하기 위한 소프트웨어 프레임워크
</aside>



- 실행 프로그램을 독립적으로 설계
- 실행 시 프로세스간 결합도 낮춤
- 지원 언어 : C++, Python
- 센서 데이터를 시각화 해주는 Tool 있음
- 공식 문서 :  [Documentation - ROS Wiki](https://wiki.ros.org/Documentation)

<br>

#### 1) Message/Topic


<aside>
💡 Master를 통해 Publisher와 Subscriber의 정보를 공유해서 메세지를 주고 받음

</aside>

- 노드 간에 데이터를 주고 받을 때 사용
- Topic과 Message 타입이 일치해야함

![Simulator](../images/명세서(1)_images/0227.png)

<br>

#### 2) rosbridge



<aside>
💡 ROS 외부 프로그램 (Morai Simulator)와의 네트워크 통신의 중간 다리 역할
</aside>

- JSON 형식의 데이터 ↔ ROS 메세지 변경해 통신을 연결하는 패키지
- ROS 통신을 이용해 Local ip 뿐만 아니라 외부에서도 통신 가능
- 시뮬레이터 : ROS Message 형식에 맞춰 JSON 형식으로 데이터를 전송
- rosbridge : 시뮬레이터로부터 받은 데이터를 ROS 메세지로 변경하여 ROS Master에 전송

<br>

#### 3) rviz, rqt


<aside>
💡 시각화 Tool

</aside>

- Topic을 Subscribe하여 데이터 타입에 따라 시각화
- 메시지, 노드, 센서 데이터가 한눈에 보임 → 디버깅 편리

```markdown
rqt_plot : 토픽을 이용해 그래프를 그려줌

rviz : 라이다, tf, image 등의 메세지를 3D로 시각화 해줌

rqt_graph : 노드와 메세지와의 관계를 한 눈에 보기 쉽게 그래프를 그려줌
```

<br>
<br>

---

## 2) 센서 (Sensor)



<aside>
💡 Keyword : 카메라, 라이다, 레이더, GPS, IMU, Ground Truth
</aside>

<br>

#### 1) 카메라 (Camera)


- 보이는 객체들을 인식하기 위해서 여러가지 연산들이 필요
- 물체에 대한 정확한 거리 알 수 없음
- 밤이나 악천후 같은 외부환경에 따라 품질 떨어짐
- 비교적 낮은 단가

<br>

#### 2) 라이다 (LiDAR)


<aside>
💡 레이저 펄스(Pulse)를 쏘아서 반사되어 돌아오는 시간을 이용하여 거리를 인지하는 센서

</aside>

[라이다의 원리와 장단점, 구현 방식에 따른 종류](https://www.epnc.co.kr/news/articleView.html?idxno=82099)

- 장점
    - 정밀도 높음 → 작은 물체도 감지할 수 있음
    - 형태 인식 가능
    - 정확한 3D 이미지 제공 가능
- 단점
    - 에너지 소비와 가격대 높음
    - 크기가 큼
    - 눈/비에 반사될 수 있어 악천후의 영향 존재

<br>

#### 3) 레이더 (Radar)


<aside>
💡 전파를 매개체로 사물 간 거리와 형태를 파악하는 센서

</aside>

- 장점
    - 소형화 가능
    - 다른 센서보다 날씨에 영향을 많이 받지 안흥ㅁ
- 단점
    - 라이다 센서보다 정밀도 떨어짐
    - 작은 물체는 식별이 어려움
    - 정밀한 이미지를 제공하지 못함
    - 물체의 종류를 판독하지 못함
    - 최대 측정 거리에 반비례하여 측정범위가 줄어듬

<br>

#### 4) GPS (Global Positioning System)


<aside>
💡 현재 위치를 손쉽게 알아낼 수 있는 편리한 센서

</aside>

- 중궤도(고도 2000~3600km) 위성망에서 같은 시간대에 모든 위성이 신호를 보내 주어서 수신기를 통해 각 위성으로부터 신호가 내려오는 시간을 측정 → 순간 위치를 계산
- 장점
    - 성능이 상향 평준화 되어 저렴한 가격에 괜찮은 성능 탑재 가능
    - 비교적 낮은 단가 + 꽤나 높은 정확도 = 자율주행 안성맞춤

<br>

#### 5) IMU (Inertial Measurement Unit)


<aside>
💡 가속도계(가속도) / 회전속도계(자이로) / 자력계(지자기)의 조합을 사용하여 힘과 방향 자기장을 측정하는 관성 측정 센서

- 장점
    - 현재 물체의 가속도 및 각속도를 측정하여 물체의 자세를 측정
    - 거리/속도/가속도 관계를 통해 속도와 거리 측정 가능
- 단점
    - 시간이 지나면 점점 오차가 누적되어 정확도 떨어짐
</aside>

- **자이로 센서 : 3축에 대한 회전 각 속도를 측정**
    - 직교 좌표계의 3축 기준으로 회전의 변화량을 측정
    - 적분을 통해 회전각과 기울기를 측정 → 적분에 의한 누적 오차 발생
    - X축 회전: Roll
    - Y축 회전: Pitch
    - Z축 회전 : Yaw
    
- **가속도 센서 : 3축의 가속도를 측정**
    - 직교 좌표계의 3축의 방향으로 가속도 측정
    - 정지 상태에서 중력 가속도 감지함 (Z축 방향으로 -G)
    - 단점 : 노이즈, 이동, 진동에 취약함

- **지자기 센서 : 지구의 자기장을 읽는 센서 (9축 IMU에 탑재됨)**
    - 지구의 북쪽이 어디인지 측정 후 자이로센서와 함께 북쪽 방향과 각도 차이로 Yaw 값을 계산
    
<br>

#### 6) Ground Truth (참 또는 정답)


<aside>
💡 시뮬레이터에서 3개( RGB/Semantic/Instance )의 Ground Truth 선택 가능
</aside>

- RGB : 빛의 3원색
    - Red, Green, Blue
    - 시뮬레이터에 카메라 센서를 통해 나오는 기본 이미지

- Semantic
    - 같은 객체들끼리 구분을 해주는 기능
    - 차량은 차량끼리, 사람은 사람끼리 등등
    - 내 차량이 주행할 수 있는 영역은 어디인지 판단 가능

- Instance
    - 사용가능한 리소스 무한인 경우 : Semantic 대체 가능
    - 사용가능한 리소스 제한인 경우 : Semantic과 Instance 잘 분리해서 사용

- Intensity (라이다, 레이더의 경우)
    - 반사되어 돌아오는 신호의 강도에 따라 색깔을 다르게 표현
    - 신호가 통과하는 매질이나 물체의 표면의 거칠기, 각도에 따라 반사율 다르게 적용되어 돌아와 신호의 세기가 결정됨



